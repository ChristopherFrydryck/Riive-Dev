{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _jsxFileName = \"/Users/christopherfrydryck/Documents/Dev/Riive-Dev/riive/features/camera-roll/ImageBrowser.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React from 'react';\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport FlatList from \"react-native-web/dist/exports/FlatList\";\nimport Dimensions from \"react-native-web/dist/exports/Dimensions\";\nimport Platform from \"react-native-web/dist/exports/Platform\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport ActivityIndicator from \"react-native-web/dist/exports/ActivityIndicator\";\nimport CameraRoll from \"react-native-web/dist/exports/CameraRoll\";\nimport PermissionsAndroid from \"react-native-web/dist/exports/PermissionsAndroid\";\nimport * as FileSystem from 'expo-file-system';\nimport ImageTile from \"./ImageTile\";\n\nvar _Dimensions$get = Dimensions.get('window'),\n    width = _Dimensions$get.width;\n\nvar ImageBrowser = function (_React$Component) {\n  _inherits(ImageBrowser, _React$Component);\n\n  var _super = _createSuper(ImageBrowser);\n\n  function ImageBrowser(props) {\n    var _this;\n\n    _classCallCheck(this, ImageBrowser);\n\n    _this = _super.call(this, props);\n\n    _this.selectImage = function (index) {\n      var newSelected = _objectSpread({}, _this.state.selected);\n\n      if (newSelected[index]) {\n        delete newSelected[index];\n      } else {\n        newSelected[index] = true;\n      }\n\n      if (Object.keys(newSelected).length > _this.props.max) return;\n      if (!newSelected) newSelected = {};\n\n      _this.setState({\n        selected: newSelected\n      });\n    };\n\n    _this.getPhotos = function () {\n      var params = {\n        first: 50,\n        assetType: 'Photos'\n      };\n      if (_this.state.after) params.after = _this.state.after;\n      if (Platform.OS === 'ios') params.groupTypes = 'All';\n      if (!_this.state.has_next_page) return;\n      CameraRoll.getPhotos(params).then(_this.processPhotos);\n    };\n\n    _this.getPhotoswithPermissions = function _callee() {\n      var granted;\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              console.log(\"TRYING>>>\");\n\n              if (!(Platform.OS === 'ios')) {\n                _context.next = 5;\n                break;\n              }\n\n              _this.getPhotos();\n\n              _context.next = 15;\n              break;\n\n            case 5:\n              _context.prev = 5;\n              _context.next = 8;\n              return _regeneratorRuntime.awrap(PermissionsAndroid.request(PermissionsAndroid.PERMISSIONS.READ_EXTERNAL_STORAGE, {\n                'title': 'Access Storage',\n                'message': \"Access Storage for the pictures\"\n              }));\n\n            case 8:\n              granted = _context.sent;\n\n              if (granted === PermissionsAndroid.RESULTS.GRANTED) {\n                console.log(\"ACCESS GRANTED!\");\n\n                _this.getPhotos();\n              } else {\n                console.log(\"Permissions Denied\");\n              }\n\n              _context.next = 15;\n              break;\n\n            case 12:\n              _context.prev = 12;\n              _context.t0 = _context[\"catch\"](5);\n              console.warn(_context.t0);\n\n            case 15:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, [[5, 12]], Promise);\n    };\n\n    _this.processPhotos = function (r) {\n      if (_this.state.after === r.page_info.end_cursor) return;\n      var uris = r.edges.map(function (i) {\n        return i.node;\n      }).map(function (i) {\n        return i.image;\n      }).map(function (i) {\n        return i.uri;\n      });\n\n      _this.setState({\n        photos: [].concat(_toConsumableArray(_this.state.photos), _toConsumableArray(uris)),\n        after: r.page_info.end_cursor,\n        has_next_page: r.page_info.has_next_page\n      });\n    };\n\n    _this.getItemLayout = function (data, index) {\n      var length = width / 4;\n      return {\n        length: length,\n        offset: length * index,\n        index: index\n      };\n    };\n\n    _this.renderHeader = function () {\n      var selectedCount = Object.keys(_this.state.selected).length;\n      var headerText = selectedCount + ' Selected';\n      if (selectedCount === _this.props.max) headerText = headerText + ' (Max)';\n      return React.createElement(View, {\n        style: styles.header,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 138,\n          columnNumber: 7\n        }\n      }, React.createElement(Button, {\n        title: \"Exit\",\n        onPress: function onPress() {\n          return _this.props.callback(Promise.resolve([]));\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 139,\n          columnNumber: 9\n        }\n      }), React.createElement(Text, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 143,\n          columnNumber: 9\n        }\n      }, headerText), React.createElement(Button, {\n        title: \"Choose\",\n        onPress: function onPress() {\n          return _this.prepareCallback();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 144,\n          columnNumber: 9\n        }\n      }));\n    };\n\n    _this.renderImageTile = function (_ref) {\n      var item = _ref.item,\n          index = _ref.index;\n      var selected = _this.state.selected[index] ? true : false;\n      return React.createElement(ImageTile, {\n        item: item,\n        numSelected: index,\n        index: index,\n        selected: selected,\n        selectImage: _this.selectImage,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 7\n        }\n      });\n    };\n\n    _this.state = {\n      photos: [],\n      selected: {},\n      after: null,\n      has_next_page: true\n    };\n    return _this;\n  }\n\n  _createClass(ImageBrowser, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.getPhotos();\n    }\n  }, {\n    key: \"prepareCallback\",\n    value: function prepareCallback() {\n      var _this$state = this.state,\n          selected = _this$state.selected,\n          photos = _this$state.photos;\n      var selectedPhotos = photos.filter(function (item, index) {\n        return selected[index];\n      });\n      var files = selectedPhotos.map(function (i) {\n        return FileSystem.getInfoAsync(i, {\n          md5: true\n        });\n      });\n      var callbackResult = Promise.all(files).then(function (imageData) {\n        return imageData.map(function (data, i) {\n          return _objectSpread({\n            file: selectedPhotos[i]\n          }, data);\n        });\n      });\n      this.props.callback(callbackResult);\n    }\n  }, {\n    key: \"renderImages\",\n    value: function renderImages() {\n      var _this2 = this;\n\n      return React.createElement(FlatList, {\n        data: this.state.photos,\n        numColumns: 4,\n        renderItem: this.renderImageTile,\n        keyExtractor: function keyExtractor(_, index) {\n          return index;\n        },\n        onEndReached: function onEndReached() {\n          _this2.getPhotoswithPermissions();\n        },\n        onEndReachedThreshold: 0.5,\n        ListEmptyComponent: React.createElement(View, {\n          style: {\n            flex: 1,\n            alignItems: 'center',\n            justifyContent: 'center'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 172,\n            columnNumber: 29\n          }\n        }, React.createElement(ActivityIndicator, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 172,\n            columnNumber: 101\n          }\n        })),\n        initialNumToRender: 24,\n        getItemLayout: this.getItemLayout,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 165,\n          columnNumber: 7\n        }\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return React.createElement(View, {\n        style: styles.container,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 181,\n          columnNumber: 7\n        }\n      }, this.renderHeader(), this.renderImages());\n    }\n  }]);\n\n  return ImageBrowser;\n}(React.Component);\n\nexport { ImageBrowser as default };\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1\n  },\n  header: {\n    height: 50,\n    width: width,\n    justifyContent: 'space-between',\n    flexDirection: 'row',\n    alignItems: 'center',\n    padding: 10,\n    marginTop: 20\n  }\n});","map":{"version":3,"sources":["/Users/christopherfrydryck/Documents/Dev/Riive-Dev/riive/features/camera-roll/ImageBrowser.js"],"names":["React","FileSystem","ImageTile","Dimensions","get","width","ImageBrowser","props","selectImage","index","newSelected","state","selected","Object","keys","length","max","setState","getPhotos","params","first","assetType","after","Platform","OS","groupTypes","has_next_page","CameraRoll","then","processPhotos","getPhotoswithPermissions","console","log","PermissionsAndroid","request","PERMISSIONS","READ_EXTERNAL_STORAGE","granted","RESULTS","GRANTED","warn","r","page_info","end_cursor","uris","edges","map","i","node","image","uri","photos","getItemLayout","data","offset","renderHeader","selectedCount","headerText","styles","header","callback","Promise","resolve","prepareCallback","renderImageTile","item","selectedPhotos","filter","files","getInfoAsync","md5","callbackResult","all","imageData","file","_","flex","alignItems","justifyContent","container","renderImages","Component","StyleSheet","create","height","flexDirection","padding","marginTop"],"mappings":"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","sourcesContent":["  \nimport React from 'react';\nimport {\n  StyleSheet,\n  Text,\n  View,\n  FlatList,\n  Dimensions,\n  Platform,\n  Button,\n  ActivityIndicator,\n  CameraRoll,\n  PermissionsAndroid,\n} from 'react-native';\nimport * as FileSystem from 'expo-file-system';\nimport ImageTile from './ImageTile';\nconst { width } = Dimensions.get('window')\n\nexport default class ImageBrowser extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      photos: [],\n      selected: {},\n      // orderSelected: [],\n      after: null,\n      has_next_page: true\n    }\n  }\n\n  componentDidMount() {\n    this.getPhotos()\n  }\n\n  selectImage = (index) => {\n   \n    let newSelected = {...this.state.selected};\n    // let newArr = this.state.orderSelected\n    if (newSelected[index]) {\n      // for(let i = 0; i < newArr.length; i++){\n      //   if(newArr[i] == index){\n      //     console.log(\"removing \" + newArr[i])\n      //     newArr.splice(i, 1)\n      //   }else{\n          \n      //   }\n      // }\n    \n        \n        // this.setState({orderSelected: this.state.orderSelected.filter(x => x !== index)});\n      \n      delete newSelected[index];\n    \n    } else {\n      newSelected[index] = true\n    }\n\n    if (Object.keys(newSelected).length > this.props.max)\n     return;\n    if (!newSelected) newSelected = {};\n    this.setState({ selected: newSelected})\n    // this.setState({ selected: newSelected, orderSelected: [...this.state.orderSelected, index]})\n\n\n    // console.log(newArr)\n    // console.log(this.state.orderSelected)\n  }\n\n  getPhotos = () => {\n    let params = { first: 50, assetType: 'Photos' };\n    if (this.state.after) params.after = this.state.after\n    if (Platform.OS === 'ios') params.groupTypes = 'All' \n    if (!this.state.has_next_page) return\n    CameraRoll\n      .getPhotos(params)\n      .then(this.processPhotos)\n  }\n\n  getPhotoswithPermissions = async() => {\n    console.log(\"TRYING>>>\")\n    if(Platform.OS === 'ios'){\n        this.getPhotos()\n    }else{\n        try{\n            const granted = await PermissionsAndroid.request(PermissionsAndroid.PERMISSIONS.READ_EXTERNAL_STORAGE, {\n              'title': 'Access Storage',\n              'message': \"Access Storage for the pictures\"\n            })\n            if(granted === PermissionsAndroid.RESULTS.GRANTED){\n                console.log(\"ACCESS GRANTED!\")\n                this.getPhotos();\n            }else{\n                console.log(\"Permissions Denied\")\n            }\n        }catch(e){\n            console.warn(e)\n        }\n    }\n  }\n\n  processPhotos = (r) => {\n    if (this.state.after === r.page_info.end_cursor) return;\n    let uris = r.edges.map(i=> i.node).map(i=> i.image).map(i=>i.uri)\n    this.setState({\n      photos: [...this.state.photos, ...uris],\n      after: r.page_info.end_cursor,\n      has_next_page: r.page_info.has_next_page\n    });\n  }\n\n  getItemLayout = (data,index) => {\n    let length = width/4;\n    return { length, offset: length * index, index }\n  }\n\n  prepareCallback() {\n    let { selected, photos } = this.state;\n    let selectedPhotos = photos.filter((item, index) => {\n      return(selected[index])\n    });\n    let files = selectedPhotos\n      .map(i => FileSystem.getInfoAsync(i, {md5: true}))\n    let callbackResult = Promise\n      .all(files)\n      .then(imageData=> {\n        return imageData.map((data, i) => {\n          return {file: selectedPhotos[i], ...data}\n        })\n      })\n    this.props.callback(callbackResult)\n  }\n\n  renderHeader = () => {\n    let selectedCount = Object.keys(this.state.selected).length;\n    let headerText = selectedCount + ' Selected';\n    if (selectedCount === this.props.max) headerText = headerText + ' (Max)';\n    return (\n      <View style={styles.header}>\n        <Button\n          title=\"Exit\"\n          onPress={() => this.props.callback(Promise.resolve([]))}\n        />\n        <Text>{headerText}</Text>\n        <Button\n          title=\"Choose\"\n          onPress={() => this.prepareCallback()}\n        />\n      </View>\n    )\n  }\n  renderImageTile = ({item, index}) => {\n    let selected = this.state.selected[index] ? true : false\n    return(\n      <ImageTile\n        item={item}\n        numSelected = {index}\n        index={index}\n        selected={selected}\n        selectImage={this.selectImage}\n      />\n    )\n  }\n  renderImages() {\n    return(\n      <FlatList\n        data={this.state.photos}\n        numColumns={4}\n        renderItem={this.renderImageTile}\n        keyExtractor={(_,index) => index}\n        onEndReached={()=> {this.getPhotoswithPermissions()}}\n        onEndReachedThreshold={0.5}\n        ListEmptyComponent={<View style={{flex: 1, alignItems: 'center', justifyContent: 'center'}}><ActivityIndicator /></View>}\n        initialNumToRender={24}\n        getItemLayout={this.getItemLayout}\n      />\n    )\n  }\n\n  render() {\n    return (\n      <View style={styles.container}>\n        {this.renderHeader()}\n        {this.renderImages()}\n      </View>\n    );\n  }\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n  },\n  header: {\n    height: 50,\n    width: width,\n    justifyContent: 'space-between',\n    flexDirection: 'row',\n    alignItems: 'center',\n    padding: 10,\n    marginTop: 20\n  },\n})"]},"metadata":{},"sourceType":"module"}